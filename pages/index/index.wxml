<view class="game-container">
  <view class="modal-overlay" wx:if="{{showModal}}">
    <view class="rules-modal">
      <image class="modal-banner" src="http://picnew11.photophoto.cn/20170315/napolun-22544446_1.jpg" mode="aspectFill"></image>
      <view class="modal-content">
        <text class="modal-title">琉璃孤独棋</text>
        <view class="modal-desc">
          <text class="desc-line">1. 点击移除任意一颗珠子开始游戏。</text>
          <text class="desc-line">2. 跳过一颗珠子并落入空位即可消除它。</text>
          <text class="desc-line">3. 努力消除，直到棋盘只剩一颗！</text>
        </view>
        <button class="confirm-btn" bindtap="closeModal">开始挑战</button>
      </view>
    </view>
  </view>

  <view class="modal-overlay" wx:if="{{showResult}}">
    <view class="rules-modal">
      <view class="modal-content" style="padding: 60rpx 0;">
        <text class="result-rank-icon">{{rankIcon}}</text>
        <text class="modal-title">{{rankName}}</text>
        <view class="result-info">
          <text>棋盘上还剩下 {{pieceCount}} 颗棋子</text>
        </view>
        <button class="confirm-btn" bindtap="resetGame" style="width: 80%; margin: 40rpx auto 0;">再挑战一次</button>
      </view>
    </view>
  </view>

  <view class="header">
    <view class="score-card">剩余骑士：<text class="num">{{pieceCount}}</text></view>
    <view style="display: flex; gap: 16rpx;">
      <view class="reset-btn" style="background: #8d6e63;" bindtap="undoMove">撤销</view>
      <view class="reset-btn" bindtap="resetGame">重置</view>
    </view>
  </view>

  <view class="board-area">
    <view class="game-board">
      <block wx:for="{{boardData}}" wx:for-index="ri" wx:for-item="row" wx:key="ri">
        <view class="board-row">
          <block wx:for="{{row}}" wx:for-index="ci" wx:for-item="cell" wx:key="ci">
            <view wx:if="{{cell}}" 
                  class="cell {{selected.ri === ri && selected.ci === ci ? 'selected' : ''}}" 
                  data-ri="{{ri}}" data-ci="{{ci}}" bindtap="handleTap">
              <view class="piece color-{{cell.color}}" wx:if="{{cell.hasPiece}}"></view>
            </view>
            <view wx:else class="cell-empty"></view>
          </block>
        </view>
      </block>
    </view>
  </view>
  <view class="watermark">Copyright © lvyw</view>
</view>